{"version":3,"file":"app.7de35dfe.js","sources":["../../../../../buildchain/src/js/components/GarnishExportModal.js","../../../../../buildchain/src/js/components/ExportButtonComponent.js","../../../../../buildchain/src/js/main.js"],"sourcesContent":["/** global: Craft */\n/** global: Garnish */\n/** global: $ */\n\n/**\n * Craftpageexporter Export Modal\n */\nCraft.CraftpageexporterExportModal = Garnish.Modal.extend({\n\n        $spinner: null,\n        requestId: 0,\n\n        /**\n         * Initialize the modal\n         * entryIds is a comma separated list of the entry ids to export\n         *\n         * @string entryIds\n         */\n        init: function (entryIds) {\n            Craft.CraftpageexporterExportModal.openInstance = this;\n\n            let settings    = {};\n            settings.onHide = this._onHide.bind(this);\n\n            this.$container = $('<div id=\"select-fields-modal\" class=\"modal loading\"/>').appendTo(Garnish.$bod);\n\n            this.base(this.$container, $.extend({\n                resizable: false\n            }, settings));\n\n            // Cut the flicker, just show the nice person the preview.\n            if (this.$container) {\n                this.$container.velocity('stop');\n                this.$container.show().css('opacity', 1);\n\n                this.$shade.velocity('stop');\n                this.$shade.show().css('opacity', 1);\n            }\n            this.loadModalContent(entryIds);\n        },\n\n        loadModalContent: function (entryIds) {\n            this._initSpinner();\n            this.requestId++;\n\n            Craft.postActionRequest('craft-page-exporter/default/get-export-modal-content', {\n                entryIds: entryIds,\n                requestId: this.requestId,\n                siteId: this.getSiteId()\n            }, function (response, textStatus) {\n                if (textStatus === 'success') {\n                    if (response.success) {\n                        if (response.requestId != this.requestId) {\n                            return;\n                        }\n                        this.$container.removeClass('loading');\n                        this.$spinner.remove();\n                        this.loaded = true;\n                        this.$container.append(response.modalHtml);\n                        Craft.initUiElements(this.$container);\n                    } else {\n                        alert(response.error);\n                        this.hide();\n                    }\n                }\n            }.bind(this));\n        },\n\n        getSiteId() {\n            let siteIdInput = $(\"input[name=siteId]\")[0];\n\n            if (siteIdInput) {\n                return siteIdInput.value;\n            }\n\n            if (Craft.elementIndex && Craft.elementIndex.siteId) {\n                return Craft.elementIndex.siteId;\n            }\n\n            return Craft.siteId;\n        },\n\n\n        _initSpinner: function () {\n            this.$container.addClass('loading');\n            this.$spinner = $('<div class=\"spinner centeralign\"></div>').appendTo(this.$container);\n            var top       = (this.$container.height() / 2 - this.$spinner.height() / 2) + 'px',\n                left      = (this.$container.width() / 2 - this.$spinner.width() / 2) + 'px';\n\n            this.$spinner.css({left: left, top: top, position: 'absolute'});\n        },\n\n        _onHide: function () {\n            Craft.CraftpageexporterExportModal.openInstance = null;\n            this.$shade.remove();\n            return this.destroy();\n        },\n    },\n    {\n        defaultSettings: {}\n    });\n","export default class ExportButtonComponent {\n    init() {\n        console.log('Export button component');\n\n        const actionButtonsContainer = document.getElementById('action-buttons');\n        console.log(actionButtonsContainer);\n        if (actionButtonsContainer === null) return;\n\n        // Create btn group\n        let btnGroup = this.createBtnGroup();\n\n        // Add btn\n        actionButtonsContainer.prepend(btnGroup);\n\n        // Add menu\n        this.addMenu(btnGroup);\n        console.log(btnGroup)\n    }\n\n    createBtnGroup() {\n        let btnGroup = document.createElement('div');\n        btnGroup.classList.add('btngroup', 'btngroup--share');\n\n        let btnExport = document.createElement('a');\n        btnExport.classList.add('btn', 'export');\n        btnExport.innerHTML = \"Export\";\n        btnExport.href      = this.getBtnExportLink();\n\n        btnGroup.appendChild(btnExport);\n\n        return btnGroup;\n    }\n\n    addMenu(btnGroup) {\n        let btnMore = document.createElement('div');\n        btnMore.classList.add('btn', 'menubtn');\n        btnGroup.appendChild(btnMore);\n\n        let menu = document.createElement('div');\n        menu.classList.add('menu');\n\n        let list = document.createElement('ul');\n        menu.appendChild(list);\n\n        let listItem = document.createElement('li');\n        list.appendChild(listItem);\n\n        let btnCustomExport       = document.createElement('a');\n        btnCustomExport.innerHTML = \"Custom export\";\n        btnCustomExport.addEventListener('click', this.onBtnExportClick.bind(this));\n        listItem.appendChild(btnCustomExport);\n\n        this.insertAfter(menu, btnMore);\n\n        new Garnish.MenuBtn(btnMore);\n    }\n\n    onBtnExportClick() {\n        new Craft.CraftpageexporterExportModal(this.getEntryId());\n    }\n\n    getBtnExportLink() {\n        let url = Craft.getUrl(`page-exporter/export/entry-${this.getEntryId()}/site-${this.getSiteId()}`);\n        return url.replace('admin/', '');\n    }\n\n    getEntryId() {\n        let entryIdInput = document.getElementsByName('sourceId')[0];\n        return entryIdInput.value;\n    }\n\n    getSiteId() {\n        let siteIdInput = $(\"input[name=siteId]\")[0];\n\n        if (siteIdInput) {\n            return siteIdInput.value;\n        }\n        // let siteId = $('.menu li>a.sel').data('site-id');\n\n        return Craft.siteId;\n    }\n\n    insertAfter(el, referenceNode) {\n        console.log('Insert before', referenceNode);\n        referenceNode.parentNode.insertBefore(el, referenceNode.nextSibling);\n    }\n}\n","import '../css/main.scss';\nimport './components/GarnishExportModal';\nimport ExportButtonComponent from './components/ExportButtonComponent';\n\nconst exportButtonComponent = new ExportButtonComponent();\nexportButtonComponent.init();\n"],"names":[],"mappings":"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"}