{"version":3,"file":"app.8d3cbd88.js","sources":["../../../../../buildchain/src/js/components/GarnishExportModal.js","../../../../../buildchain/src/js/components/ExportButtonComponent.js","../../../../../buildchain/src/js/main.js"],"sourcesContent":["/** global: Craft */\n/** global: Garnish */\n/** global: $ */\n\n/**\n * Craftpageexporter Export Modal\n */\nCraft.CraftpageexporterExportModal = Garnish.Modal.extend({\n\n        $spinner: null,\n        requestId: 0,\n\n        /**\n         * Initialize the modal\n         * entryIds is a comma separated list of the entry ids to export\n         *\n         * @string entryIds\n         */\n        init: function (entryIds) {\n            Craft.CraftpageexporterExportModal.openInstance = this;\n\n            let settings    = {};\n            settings.onHide = this._onHide.bind(this);\n\n            this.$container = $('<div id=\"select-fields-modal\" class=\"modal loading\"/>').appendTo(Garnish.$bod);\n\n            this.base(this.$container, $.extend({\n                resizable: false\n            }, settings));\n\n            // Cut the flicker, just show the nice person the preview.\n            if (this.$container) {\n                this.$container.velocity('stop');\n                this.$container.show().css('opacity', 1);\n\n                this.$shade.velocity('stop');\n                this.$shade.show().css('opacity', 1);\n            }\n            this.loadModalContent(entryIds);\n        },\n\n        loadModalContent: function (entryIds) {\n            this._initSpinner();\n            this.requestId++;\n\n            Craft.postActionRequest('craft-page-exporter/default/get-export-modal-content', {\n                entryIds: entryIds,\n                requestId: this.requestId,\n                siteId: this.getSiteId()\n            }, function (response, textStatus) {\n                if (textStatus === 'success') {\n                    if (response.success) {\n                        if (response.requestId != this.requestId) {\n                            return;\n                        }\n                        this.$container.removeClass('loading');\n                        this.$spinner.remove();\n                        this.loaded = true;\n                        this.$container.append(response.modalHtml);\n                        Craft.initUiElements(this.$container);\n                    } else {\n                        alert(response.error);\n                        this.hide();\n                    }\n                }\n            }.bind(this));\n        },\n\n        getSiteId() {\n            let siteIdInput = $(\"input[name=siteId]\")[0];\n\n            if (siteIdInput) {\n                return siteIdInput.value;\n            }\n\n            if (Craft.elementIndex && Craft.elementIndex.siteId) {\n                return Craft.elementIndex.siteId;\n            }\n\n            return Craft.siteId;\n        },\n\n\n        _initSpinner: function () {\n            this.$container.addClass('loading');\n            this.$spinner = $('<div class=\"spinner centeralign\"></div>').appendTo(this.$container);\n            var top       = (this.$container.height() / 2 - this.$spinner.height() / 2) + 'px',\n                left      = (this.$container.width() / 2 - this.$spinner.width() / 2) + 'px';\n\n            this.$spinner.css({left: left, top: top, position: 'absolute'});\n        },\n\n        _onHide: function () {\n            Craft.CraftpageexporterExportModal.openInstance = null;\n            this.$shade.remove();\n            return this.destroy();\n        },\n    },\n    {\n        defaultSettings: {}\n    });\n","export default class ExportButtonComponent {\n    init() {\n        const actionButtonsContainer = document.getElementById('action-buttons');\n\n        if (\n            actionButtonsContainer === null\n            || document.getElementById('main-form') === null\n        ) return;\n\n        // Create btn group\n        let btnGroup = this.createBtnGroup();\n\n        // Add btn\n        actionButtonsContainer.prepend(btnGroup);\n\n        // Add menu\n        this.addMenu(btnGroup);\n    }\n\n    createBtnGroup() {\n        let btnGroup = document.createElement('div');\n        btnGroup.classList.add('btngroup', 'btngroup--share');\n\n        let btnExport = document.createElement('a');\n        btnExport.classList.add('btn', 'export');\n        btnExport.innerHTML = \"Export\";\n        btnExport.href      = this.getBtnExportLink();\n\n        btnGroup.appendChild(btnExport);\n\n        return btnGroup;\n    }\n\n    addMenu(btnGroup) {\n        let btnMore = document.createElement('div');\n        btnMore.classList.add('btn', 'menubtn');\n        btnGroup.appendChild(btnMore);\n\n        let menu = document.createElement('div');\n        menu.classList.add('menu');\n\n        let list = document.createElement('ul');\n        menu.appendChild(list);\n\n        let listItem = document.createElement('li');\n        list.appendChild(listItem);\n\n        let btnCustomExport       = document.createElement('a');\n        btnCustomExport.innerHTML = \"Custom export\";\n        btnCustomExport.addEventListener('click', this.onBtnExportClick.bind(this));\n        listItem.appendChild(btnCustomExport);\n\n        this.insertAfter(menu, btnMore);\n\n        new Garnish.MenuBtn(btnMore);\n    }\n\n    onBtnExportClick() {\n        new Craft.CraftpageexporterExportModal(this.getEntryId());\n    }\n\n    getBtnExportLink() {\n        let url = Craft.getUrl(`page-exporter/export/entry-${this.getEntryId()}/site-${this.getSiteId()}`);\n        return url.replace('admin/', '');\n    }\n\n    getEntryId() {\n        return document.getElementById('main-form').elementId.value;\n    }\n\n    getSiteId() {\n        let siteIdInput = $(\"input[name=siteId]\")[0];\n\n        if (siteIdInput) {\n            return siteIdInput.value;\n        }\n        // let siteId = $('.menu li>a.sel').data('site-id');\n\n        return Craft.siteId;\n    }\n\n    insertAfter(el, referenceNode) {\n        console.log('Insert before', referenceNode);\n        referenceNode.parentNode.insertBefore(el, referenceNode.nextSibling);\n    }\n}\n","import '../css/main.scss';\nimport './components/GarnishExportModal';\nimport ExportButtonComponent from './components/ExportButtonComponent';\n\nconst exportButtonComponent = new ExportButtonComponent();\nexportButtonComponent.init();\n"],"names":["entryIds","settings","response","textStatus","siteIdInput","top","left","ExportButtonComponent","actionButtonsContainer","btnGroup","btnExport","btnMore","menu","list","listItem","btnCustomExport","el","referenceNode","exportButtonComponent"],"mappings":"AAOA,MAAM,6BAA+B,QAAQ,MAAM,OAAO,CAElD,SAAU,KACV,UAAW,EAQX,KAAM,SAAUA,EAAU,CACtB,MAAM,6BAA6B,aAAe,KAElD,IAAIC,EAAc,CAAA,EAClBA,EAAS,OAAS,KAAK,QAAQ,KAAK,IAAI,EAExC,KAAK,WAAa,EAAE,uDAAuD,EAAE,SAAS,QAAQ,IAAI,EAElG,KAAK,KAAK,KAAK,WAAY,EAAE,OAAO,CAChC,UAAW,EAC3B,EAAeA,CAAQ,CAAC,EAGR,KAAK,aACL,KAAK,WAAW,SAAS,MAAM,EAC/B,KAAK,WAAW,KAAI,EAAG,IAAI,UAAW,CAAC,EAEvC,KAAK,OAAO,SAAS,MAAM,EAC3B,KAAK,OAAO,KAAI,EAAG,IAAI,UAAW,CAAC,GAEvC,KAAK,iBAAiBD,CAAQ,CACjC,EAED,iBAAkB,SAAUA,EAAU,CAClC,KAAK,aAAY,EACjB,KAAK,YAEL,MAAM,kBAAkB,uDAAwD,CAC5E,SAAUA,EACV,UAAW,KAAK,UAChB,OAAQ,KAAK,UAAW,CACxC,EAAe,SAAUE,EAAUC,EAAY,CAC/B,GAAIA,IAAe,UACf,GAAID,EAAS,QAAS,CAClB,GAAIA,EAAS,WAAa,KAAK,UAC3B,OAEJ,KAAK,WAAW,YAAY,SAAS,EACrC,KAAK,SAAS,SACd,KAAK,OAAS,GACd,KAAK,WAAW,OAAOA,EAAS,SAAS,EACzC,MAAM,eAAe,KAAK,UAAU,CAC5D,MACwB,MAAMA,EAAS,KAAK,EACpB,KAAK,KAAI,CAGjC,EAAc,KAAK,IAAI,CAAC,CACf,EAED,WAAY,CACR,IAAIE,EAAc,EAAE,oBAAoB,EAAE,GAE1C,OAAIA,EACOA,EAAY,MAGnB,MAAM,cAAgB,MAAM,aAAa,OAClC,MAAM,aAAa,OAGvB,MAAM,MAChB,EAGD,aAAc,UAAY,CACtB,KAAK,WAAW,SAAS,SAAS,EAClC,KAAK,SAAW,EAAE,yCAAyC,EAAE,SAAS,KAAK,UAAU,EACrF,IAAIC,EAAa,KAAK,WAAW,OAAQ,EAAG,EAAI,KAAK,SAAS,OAAQ,EAAG,EAAK,KAC1EC,EAAa,KAAK,WAAW,MAAK,EAAK,EAAI,KAAK,SAAS,QAAU,EAAK,KAE5E,KAAK,SAAS,IAAI,CAAC,KAAMA,EAAM,IAAKD,EAAK,SAAU,UAAU,CAAC,CACjE,EAED,QAAS,UAAY,CACjB,aAAM,6BAA6B,aAAe,KAClD,KAAK,OAAO,SACL,KAAK,SACf,CACJ,EACD,CACI,gBAAiB,CAAE,CAC3B,CAAK,ECpGU,MAAME,CAAsB,CACvC,MAAO,CACH,MAAMC,EAAyB,SAAS,eAAe,gBAAgB,EAEvE,GACIA,IAA2B,MACxB,SAAS,eAAe,WAAW,IAAM,KAC9C,OAGF,IAAIC,EAAW,KAAK,iBAGpBD,EAAuB,QAAQC,CAAQ,EAGvC,KAAK,QAAQA,CAAQ,CACxB,CAED,gBAAiB,CACb,IAAIA,EAAW,SAAS,cAAc,KAAK,EAC3CA,EAAS,UAAU,IAAI,WAAY,iBAAiB,EAEpD,IAAIC,EAAY,SAAS,cAAc,GAAG,EAC1C,OAAAA,EAAU,UAAU,IAAI,MAAO,QAAQ,EACvCA,EAAU,UAAY,SACtBA,EAAU,KAAY,KAAK,mBAE3BD,EAAS,YAAYC,CAAS,EAEvBD,CACV,CAED,QAAQA,EAAU,CACd,IAAIE,EAAU,SAAS,cAAc,KAAK,EAC1CA,EAAQ,UAAU,IAAI,MAAO,SAAS,EACtCF,EAAS,YAAYE,CAAO,EAE5B,IAAIC,EAAO,SAAS,cAAc,KAAK,EACvCA,EAAK,UAAU,IAAI,MAAM,EAEzB,IAAIC,EAAO,SAAS,cAAc,IAAI,EACtCD,EAAK,YAAYC,CAAI,EAErB,IAAIC,EAAW,SAAS,cAAc,IAAI,EAC1CD,EAAK,YAAYC,CAAQ,EAEzB,IAAIC,EAAwB,SAAS,cAAc,GAAG,EACtDA,EAAgB,UAAY,gBAC5BA,EAAgB,iBAAiB,QAAS,KAAK,iBAAiB,KAAK,IAAI,CAAC,EAC1ED,EAAS,YAAYC,CAAe,EAEpC,KAAK,YAAYH,EAAMD,CAAO,EAE9B,IAAI,QAAQ,QAAQA,CAAO,CAC9B,CAED,kBAAmB,CACf,IAAI,MAAM,6BAA6B,KAAK,WAAY,CAAA,CAC3D,CAED,kBAAmB,CAEf,OADU,MAAM,OAAO,8BAA8B,KAAK,WAAY,UAAS,KAAK,UAAW,GAAE,EACtF,QAAQ,SAAU,EAAE,CAClC,CAED,YAAa,CACT,OAAO,SAAS,eAAe,WAAW,EAAE,UAAU,KACzD,CAED,WAAY,CACR,IAAIP,EAAc,EAAE,oBAAoB,EAAE,GAE1C,OAAIA,EACOA,EAAY,MAIhB,MAAM,MAChB,CAED,YAAYY,EAAIC,EAAe,CAC3B,QAAQ,IAAI,gBAAiBA,CAAa,EAC1CA,EAAc,WAAW,aAAaD,EAAIC,EAAc,WAAW,CACtE,CACL,CCjFA,MAAMC,EAAwB,IAAIX,EAClCW,EAAsB,KAAM"}